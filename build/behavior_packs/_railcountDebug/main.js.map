{"version":3,"sources":["main.ts"],"names":[],"mappings":"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","file":"../railcount/scripts/main.js","sourcesContent":["import { world, system, Entity, Player, BlockPermutation, Vector3, Block, Dimension, BlockType, MinecraftBlockTypes } from \"@minecraft/server\";\n//Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n//The execution policy stuff\nenum Dir {\n  FUP,\n  FC,\n  BUP,\n  BC,\n  LUP,\n  LC,\n  RUP,\n  RC,\n}\nfunction checkStateAndLoc(p: Player) {\n  const b: Block | undefined = p.dimension.getBlock(p.location);\n  if (b !== undefined) {\n    let n: number | boolean | string | undefined = b.permutation.getState(\"rail_direction\");\n    if (typeof n === \"number\") {\n      world.sendMessage(n + \" : \" + p.location.x + \" \" + p.location.y + \" \" + p.location.z);\n    }\n  }\n\n}\nclass RailLoc implements Vector3 {\n  public constructor(x: number, y: number, z: number) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n  }\n  x: number;\n  y: number;\n  z: number;\n  public compare(v: Vector3) {\n    if (this.x === v.x && this.y === v.y && this.z === v.z) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n  public offset(x: number, y: number, z: number) {\n    return new RailLoc(this.x + x, this.y + y, this.z + z);\n  }\n}\nclass RailIterator {\n  d: Dimension;\n  lenght: number;\n  current: RailLoc;\n  previous: RailLoc;\n  public constructor(x: number, y: number, z: number, d: Dimension) {\n    this.d = d;\n    this.lenght = 0;\n    this.current = new RailLoc(Math.floor(x), Math.floor(y), Math.floor(z));\n\n    this.previous = new RailLoc(0, -64, 0);\n  }\n  public run(p: Player) {\n    while (this.next()) {\n      this.lenght++;\n\n    }\n    this.d.runCommandAsync(\"tp @a \" + this.current.x.toString() + \" \" + this.current.y.toString() + \" \" + this.current.z.toString())\n\n    return this.lenght.toString();\n  }\n  public next() {\n\n    let b: Block | undefined = this.d.getBlock(this.current);\n\n    if (b !== undefined) {\n      let s: number | boolean | undefined | string = b?.permutation.getState(\"rail_direction\");\n      if (typeof s === \"number\") {\n        let next: RailLoc | boolean = this.current;\n        switch (s) {\n          case 0:\n            next = this.validate(this.current.offset(0, 0, 1), this.current.offset(0, 0, -1));\n            break;\n          case 1:\n            next = this.validate(this.current.offset(-1, 0, 0), this.current.offset(1, 0, 0));\n            break;\n          case 2:\n            next = this.validate(this.current.offset(-1, 0, 0), this.current.offset(1, 1, 0));\n            break;\n          case 3:\n            next = this.validate(this.current.offset(-1, 1, 0), this.current.offset(1, 0, 0));\n            break;\n          case 4:\n            next = this.validate(this.current.offset(0, 1, -1), this.current.offset(0, 0, 1));\n            break;\n          case 5:\n            next = this.validate(this.current.offset(0, 1, 1), this.current.offset(0, 0, -1));\n            break;\n          case 6:\n            next = this.validate(this.current.offset(0, 0, 1), this.current.offset(1, 0, 0));\n            break;\n          case 7:\n            next = this.validate(this.current.offset(0, 0, 1), this.current.offset(-1, 0, 0));\n            break;\n          case 8:\n            next = this.validate(this.current.offset(0, 0, -1), this.current.offset(-1, 0, 0));\n            break;\n          case 9:\n            next = this.validate(this.current.offset(0, 0, -1), this.current.offset(1, 0, 0));\n            break;\n        }\n        if (next !== false) {\n          this.previous = this.current;\n          this.current = next;\n          return true;\n        }\n\n      }\n    }\n\n    return false;\n  }\n  private validate(loc1: RailLoc, loc2: RailLoc) {\n    let down1 = loc1.offset(0, -1, 0);\n    let down2 = loc2.offset(0, -1, 0);\n\n    if (!loc1.compare(this.previous) && this.isRail(loc1)) {\n      return loc1;\n    }\n    else if (!loc2.compare(this.previous) && this.isRail(loc2)) {\n      return loc2;\n    }\n    else if (!down1.compare(this.previous) && this.isRail(down1)) {\n      return down1;\n    }\n    else if (!down2.compare(this.previous) && this.isRail(down2)) {\n      return down2;\n    } else {\n      return false;\n    }\n  }\n  private isRail(loc: RailLoc) {\n    let b: Block | undefined = this.d.getBlock(loc);\n    if (b !== undefined) {\n      if (b?.permutation.type === MinecraftBlockTypes.rail || b?.permutation.type === MinecraftBlockTypes.goldenRail) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n}\nlet tickIndex = 0;\nfunction mainTick() {\n  try {\n    tickIndex++;\n\n    if (tickIndex === 100) {\n      world.getDimension(\"overworld\").runCommandAsync(\"say Hello starter!\");\n      world.beforeEvents.chatSend.subscribe(async (eventData) => {\n        if (eventData.message === \"po\") {\n          const p: Player = eventData.sender;\n          const counter: RailIterator = new RailIterator(p.location.x, p.location.y, p.location.z, p.dimension);\n          world.sendMessage(counter.run(eventData.sender).toString());\n          world.sendMessage(\"op\");\n        } else if (eventData.message === \"no\") {\n          checkStateAndLoc(eventData.sender);\n        }\n      });\n    }\n  } catch (e) {\n    console.warn(\"Script error: \" + e);\n  }\n\n  system.run(mainTick);\n}\n\nsystem.run(mainTick);\n"],"sourceRoot":"../../../scripts/"}